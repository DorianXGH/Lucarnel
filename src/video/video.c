#include "video.h"
#define $ 1

uint8_t chars[][8 * 10] = {
    {// space
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0},
    {// A
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {// B
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, 0, 0, 0},
    {// C
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0},
    {// D
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, 0, 0, 0},
    {// E
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0},
    {// F
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0},
    {// G
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0},
    {// H
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {// I
     0, 0, $, $, $, $, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, $, $, $, $, 0, 0},
    {// J
     0, 0, $, $, $, $, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, 0, 0, 0,
     0, 0, $, $, 0, 0, 0, 0},
    {// K
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {// L
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, $, 0, 0},
};
char charmap[256];

void initCharMap()
{
    charmap[' '] = 0;
    charmap['a'] = 1;
    charmap['b'] = 2;
    charmap['c'] = 3;
    charmap['d'] = 4;
    charmap['e'] = 5;
    charmap['f'] = 6;
    charmap['g'] = 7;
    charmap['h'] = 8;
    charmap['i'] = 9;
    charmap['j'] = 10;
    charmap['k'] = 11;
    charmap['l'] = 12;
}

void putChar(uint8_t c, uint64_t x, uint64_t y, struct stivale_struct *stivale, uint32_t foreground, uint32_t background, uint8_t zoomfactor)
{
    if (x + zoomfactor * 8 < stivale->framebuffer_width && y + zoomfactor * 8 < stivale->framebuffer_height)
    {
        for (uint64_t row = 0; row < zoomfactor * 8; row++)
        {
            uint64_t j = (row + y) * stivale->framebuffer_pitch + stivale->framebuffer_addr;
            for (uint64_t i = 0; i < zoomfactor * 10; i++)
            {
                uint32_t *pix = (uintptr_t)(j + 4 * (x + i));
                uint8_t onoff = chars[charmap[c]][(row / zoomfactor) * 8 + (i / zoomfactor)];
                *pix = onoff * foreground + (1 - onoff) * background;
            }
        }
    }
}