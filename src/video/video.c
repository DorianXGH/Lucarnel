#include "video.h"
#define $ 1

uint8_t chars[][8 * 10] = {
    {// space
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0,
     0, 0, 0, 0, 0, 0, 0, 0},
    {// A
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {// B
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, 0, 0, 0},
    {// C
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0},
    {// D
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, 0, 0, 0},
    {// E
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0},
    {// F
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0},
    {// G
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0},
    {// H
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {// I
     0, 0, $, $, $, $, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, $, $, $, $, 0, 0},
    {// J
     0, 0, $, $, $, $, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, 0, 0, 0,
     0, 0, $, $, 0, 0, 0, 0},
    {// K
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {// L
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, $, 0, 0},
    {// M
     0, $, $, 0, 0, 0, $, $,
     0, $, $, $, 0, $, $, $,
     0, $, $, $, $, $, $, $,
     0, $, $, $, $, $, $, $,
     0, $, $, 0, $, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $},
    {//N
     0, $, $, 0, 0, 0, $, $,
     0, $, $, $, 0, 0, $, $,
     0, $, $, $, 0, 0, $, $,
     0, $, $, $, $, 0, $, $,
     0, $, $, $, $, 0, $, $,
     0, $, $, 0, $, $, $, $,
     0, $, $, 0, $, $, $, $,
     0, $, $, 0, 0, $, $, $,
     0, $, $, 0, 0, $, $, $,
     0, $, $, 0, 0, 0, $, $},
    {//O
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0},
    {//P
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0},
    {//Q
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, $, $, $, 0,
     0, $, $, 0, $, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, $, $, 0},
    {//R
     0, $, $, $, $, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {//S
     0, 0, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, 0, 0, 0, 0, 0,
     0, $, $, $, $, $, 0, 0,
     0, 0, $, $, $, $, $, 0,
     0, 0, 0, 0, 0, $, $, 0,
     0, 0, 0, 0, 0, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, 0, 0},
    {//T
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0},
    {//U
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, 0, $, $, $, $, 0, 0},
    {//V
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, 0, $, 0, 0, $, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0},
    {//W
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, 0, 0, $, $,
     0, $, $, 0, $, 0, $, $,
     0, $, $, $, $, $, $, $,
     0, $, $, $, $, $, $, $,
     0, 0, $, $, 0, $, $, 0},
    {//X
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, $, 0, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0},
    {//Y
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, 0, 0, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, 0, $, $, $, $, 0, 0,
     0, 0, 0, $, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, $, 0, 0, 0,
     0, 0, $, $, 0, 0, 0, 0,
     0, 0, $, $, 0, 0, 0, 0},
    {//Z
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0,
     0, 0, 0, 0, $, $, 0, 0,
     0, 0, 0, 0, $, $, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, 0, $, $, 0, 0, 0,
     0, 0, $, $, 0, 0, 0, 0,
     0, 0, $, $, 0, 0, 0, 0,
     0, $, $, $, $, $, $, 0,
     0, $, $, $, $, $, $, 0}

};
char charmap[256];

void initCharMap()
{
    charmap[' '] = 0;
    charmap['a'] = 1;
    charmap['b'] = 2;
    charmap['c'] = 3;
    charmap['d'] = 4;
    charmap['e'] = 5;
    charmap['f'] = 6;
    charmap['g'] = 7;
    charmap['h'] = 8;
    charmap['i'] = 9;
    charmap['j'] = 10;
    charmap['k'] = 11;
    charmap['l'] = 12;
    charmap['m'] = 13;
    charmap['n'] = 14;
    charmap['o'] = 15;
    charmap['p'] = 16;
    charmap['q'] = 17;
    charmap['r'] = 18;
    charmap['s'] = 19;
    charmap['t'] = 20;
    charmap['u'] = 21;
    charmap['v'] = 22;
    charmap['w'] = 23;
    charmap['x'] = 24;
    charmap['y'] = 25;
    charmap['z'] = 26;
}

void putChar(uint8_t c, uint64_t x, uint64_t y, struct stivale_struct *stivale, uint32_t foreground, uint32_t background, uint8_t zoomfactor)
{
    if (x + zoomfactor * 8 < stivale->framebuffer_width && y + zoomfactor * 8 < stivale->framebuffer_height)
    {
        for (uint64_t row = 0; row < zoomfactor * 10; row++)
        {
            uint64_t j = (row + y) * stivale->framebuffer_pitch + stivale->framebuffer_addr;
            for (uint64_t i = 0; i < zoomfactor * 8; i++)
            {
                uint32_t *pix = (uintptr_t)(j + 4 * (x + i));
                uint8_t onoff = chars[charmap[c]][(row / zoomfactor) * 8 + (i / zoomfactor)];
                *pix = onoff * foreground + (1 - onoff) * background;
            }
        }
    }
}

void putString(uint8_t* s, uint64_t x, uint64_t y, struct stivale_struct *stivale, uint32_t foreground, uint32_t background, uint8_t zoomfactor)
{
    for(int i = 0; s[i] != 0; i++)
    {
        int effy = (y+(8*zoomfactor*i));
        putChar(s[i],x+(10*zoomfactor*(effy/(stivale->framebuffer_width))),effy%(stivale->framebuffer_width),stivale,foreground,background,zoomfactor);
    }
}